<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Calmify</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#34d399">
<link href="https://fonts.googleapis.com/css2?family=Righteous&display=swap" rel="stylesheet">

<style>
body {
  margin:0; 
  font-family:'Righteous', cursive; 
  background:linear-gradient(to bottom,#b0e0f0,#e0f7fa); 
  overflow:hidden; 
  height:100vh;
  position:relative;
}
/* Aurora effect */
.aurora {
  position:absolute; 
  inset:0; 
  background: radial-gradient(circle at 50% 50%, rgba(144,224,239,0.5), transparent 60%); 
  animation: auroraMove 20s linear infinite; 
  z-index:0;
}
@keyframes auroraMove {
  0%{background-position:0% 0%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 0%;}
}

/* Clouds */
.cloud {
  position:absolute;
  width:100px;
  height:60px;
  background:white;
  border-radius:50%;
  opacity:0.8;
  animation:floatClouds linear infinite;
  z-index:1;
}
@keyframes floatClouds {
  0%{transform:translateX(-150px);}
  100%{transform:translateX(110vw);}
}

/* Screens */
.screen {
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  transition:opacity 1.5s ease;
  z-index:2;
}
.hidden {opacity:0; pointer-events:none;}

/* Avatar */
.avatar {width:140px; height:160px; margin-bottom:20px; position:relative;}
.avatar svg {display:block; animation: float 3s ease-in-out infinite;}
@keyframes float {0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);}}
.arm {transform-origin:top center; animation:waveArm 2s ease-in-out infinite;}
@keyframes waveArm {0%,100%{transform:rotate(0deg);}50%{transform:rotate(15deg);}}
.blink {animation: blinkEyes 5s infinite;}
@keyframes blinkEyes {0%,90%,100%{opacity:1;}95%{opacity:0;}}

/* Cards */
.card {
  background: rgba(255,255,255,0.85); 
  padding:40px; 
  border-radius:25px; 
  max-width:700px; 
  text-align:center; 
  box-shadow:0 20px 40px rgba(0,0,0,0.2);
}
h1 {font-weight:400; margin-bottom:15px;}
button {
  padding:16px 36px; 
  border-radius:35px; 
  border:none; 
  font-size:20px; 
  background:#34d399; 
  color:white; 
  cursor:pointer; 
  box-shadow:0 6px 15px rgba(0,0,0,0.2); 
  transition: transform 0.2s, box-shadow 0.2s;
}
button:hover {transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,0,0,0.3);}

/* Reading passages */
.passage {margin-top:30px; font-size:22px; line-height:1.8; padding:20px; border-radius:15px; transition:background 0.5s;}
.passage.active {background: rgba(52,211,153,0.3);}

/* Mini-games visuals */
.circle {width:180px;height:180px;border-radius:50%;background:rgba(52,211,153,0.3);animation:breathe 6s ease-in-out infinite;margin:auto;}
@keyframes breathe {0%{transform:scale(0.8);}50%{transform:scale(1.15);}100%{transform:scale(0.8);}}
.focus-dot {width:30px;height:30px;background:#34d399;border-radius:50%;position:absolute;cursor:pointer;}
.trace-line {width:200px;height:20px;background:rgba(52,211,153,0.3);border-radius:10px;margin:auto;position:relative;}
.trace-dot {width:20px;height:20px;background:#34d399;border-radius:50%;position:absolute;top:-5px;animation:traceMove 4s linear infinite;}
@keyframes traceMove {0%{left:0;}100%{left:180px;}}
.reward-star {color:#ffe066;font-size:36px;margin:5px;}
</style>
</head>
<body>

<!-- Aurora and clouds -->
<div class="aurora"></div>
<div class="cloud" style="top:10%; animation-duration:60s;"></div>
<div class="cloud" style="top:25%; animation-duration:80s;"></div>
<div class="cloud" style="top:45%; animation-duration:100s;"></div>
<div class="cloud" style="top:60%; animation-duration:90s;"></div>

<!-- Start Screen -->
<div id="startScreen" class="screen">
  <div class="avatar">
    <svg viewBox="0 0 100 140" width="100" height="140">
      <ellipse cx="50" cy="110" rx="25" ry="30" fill="#34d399"/>
      <circle cx="50" cy="50" r="30" fill="#fff"/>
      <circle cx="40" cy="45" r="5" fill="#022c3a" class="blink"/>
      <circle cx="60" cy="45" r="5" fill="#022c3a" class="blink"/>
      <path d="M40 60 Q50 70 60 60" stroke="#022c3a" stroke-width="2" fill="none"/>
      <line x1="25" y1="90" x2="10" y2="70" stroke="#34d399" stroke-width="5" class="arm"/>
      <line x1="75" y1="90" x2="90" y2="70" stroke="#34d399" stroke-width="5" class="arm"/>
    </svg>
  </div>
  <h1>Welcome to Calmify</h1>
  <p>I’ll stay with you. Let’s start your calming session.</p>
  <button onclick="startSession()">Start Session</button>
</div>

<!-- Reading Screen -->
<div id="readingScreen" class="screen hidden">
  <div class="avatar">
    <!-- Avatar SVG repeated -->
  </div>
  <div class="card">
    <h1>Read this for me</h1>
    <div id="passage" class="passage"></div>
    <p style="opacity:0.7;margin-top:20px;">Speak gently. Words glow when I hear you.</p>
  </div>
</div>

<!-- Game Screen -->
<div id="gameScreen" class="screen hidden">
  <div class="avatar">
    <!-- Avatar SVG repeated -->
  </div>
  <div class="card">
    <h1 id="gameTitle">Calming Game</h1>
    <div id="gameArea"></div>
    <p id="gameHint" style="opacity:0.7;margin-top:20px;"></p>
    <div id="rewards"></div>
  </div>
</div>

<script>
// --- Session tracking ---
let sessions = Number(localStorage.getItem("sessions") || 0);

function startSession(){
  if(sessions >= 3){alert("Free sessions over! Upgrade to continue.");return;}
  sessions++; localStorage.setItem("sessions", sessions);
  startAmbient();
  speakText("Welcome! Let's begin your calming session.");
  document.getElementById("startScreen").classList.add("hidden");
  setTimeout(()=>{document.getElementById("readingScreen").classList.remove("hidden"); beginReading();},1500);
}

// --- Ambient AI sound ---
let audioCtx, ambientGain;
function startAmbient(){
  audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  ambientGain=audioCtx.createGain(); ambientGain.gain.value=0.12; ambientGain.connect(audioCtx.destination);
  for(let i=0;i<4;i++){
    const osc=audioCtx.createOscillator(); osc.type="sine";
    osc.frequency.value=60+Math.random()*100;
    const gain=audioCtx.createGain(); gain.gain.value=0.03+Math.random()*0.05;
    osc.connect(gain); gain.connect(ambientGain);
    osc.start(); osc.stop(audioCtx.currentTime+600);
  }
}

// --- AI voice ---
function speakText(text){
  if(!('speechSynthesis'in window)) return;
  const u=new SpeechSynthesisUtterance(text);
  u.pitch=0.9; u.rate=0.95; u.volume=0.8; u.lang='en-US';
  window.speechSynthesis.speak(u);
}

// --- Reading session ---
const passages=[
  "Take a slow breath in. Let your chest expand gently. Feel your body relax.",
  "Nothing is expected now. Each word can be slow, quiet, and soothing.",
  "Pause if needed. Your voice guides your calm. You are safe."
];

const avatars = document.querySelectorAll('.avatar svg');

function beginReading(){
  const passage=document.getElementById("passage");
  passage.textContent=passages[Math.floor(Math.random()*passages.length)];
  speakText(passage.textContent);
  animateAvatarDuringReading();
}

// --- Avatar animations ---
function animateAvatarDuringReading() {
  avatars.forEach(avatar=>{
    avatar.style.transform = 'translateY(0)';
    let direction = 1;
    const floatAnim = setInterval(()=>{
      let current = parseFloat(avatar.style.transform.replace('translateY(','').replace('px)','')) || 0;
      if(current > 6) direction=-1;
      if(current < -6) direction=1;
      avatar.style.transform = `translateY(${current + direction*0.3}px)`;
    },50);
    setTimeout(()=>clearInterval(floatAnim),10000); // stops after reading session
  });
}

function animateAvatarDuringGame() {
  avatars.forEach(avatar=>{
    avatar.style.transform = 'translateY(0)';
    let direction = 1;
    const gameAnim = setInterval(()=>{
      let current = parseFloat(avatar.style.transform.replace('translateY(','').replace('px)','')) || 0;
      if(current > 8) direction=-1;
      if(current < -8) direction=1;
      avatar.style.transform = `translateY(${current + direction*0.4}px) rotate(${direction*2}deg)`;
    },50);
    setTimeout(()=>clearInterval(gameAnim),12000); // stops after each mini-game
  });
}

// --- Mini-games and rewards ---
function transitionToGames(){document.getElementById("readingScreen").classList.add("hidden");setTimeout(()=>{document.getElementById("gameScreen").classList.remove("hidden");startGame();},1500);}
function startGame(){
  const area=document.getElementById("gameArea"),title=document.getElementById("gameTitle"),hint=document.getElementById("gameHint");
  area.innerHTML="";
  const games=[breathingCircle,focusDot,traceLine];
  const g=games[Math.floor(Math.random()*games.length)];
  animateAvatarDuringGame();
  g(title,hint,area);
}

function breathingCircle(title,hint,area){
  title.textContent="Breathe with me";
  hint.textContent="In as it grows, out as it shrinks.";
  speakText("Let's take slow breaths together.");
  const c=document.createElement("div");c.className="circle";area.appendChild(c);
  setTimeout(()=>{giveReward();startGame();},12000);
}

function focusDot(title,hint,area){
  title.textContent="Focus gently";
  hint.textContent="Click the dot when it appears.";
  speakText("Focus on the dot, gently.");
  spawnDot(area);
}

function spawnDot(area){
  const dot=document.createElement("div");
  dot.className="focus-dot";
  dot.style.left=Math.random()*80+"%";
  dot.style.top=Math.random()*60+"%";
  dot.onclick=()=>{
    dot.remove();
    giveReward();
    interactiveAvatarReact();
    setTimeout(()=>spawnDot(area),1200);
  };
  area.appendChild(dot);
}

function traceLine(title,hint,area){
  title.textContent="Trace the path";
  hint.textContent="Follow the moving dot slowly.";
  speakText("Trace the moving dot slowly with your eyes.");
  const line=document.createElement("div");line.className="trace-line";area.appendChild(line);
  const dot=document.createElement("div");dot.className="trace-dot";line.appendChild(dot);
  setTimeout(()=>{giveReward();startGame();},10000);
}

// --- Rewards ---
function giveReward(){
  const rewards=document.getElementById("rewards");
  const star=document.createElement("span");
  star.className="reward-star";star.textContent="★";
  rewards.appendChild(star);
  rewardAvatarAnimation();
}

function rewardAvatarAnimation(){
  avatars.forEach(avatar=>{
    avatar.style.transition="transform 0.2s ease";
    avatar.style.transform="translateY(-10px) scale(1.05)";
    setTimeout(()=>{avatar.style.transform="translateY(0) scale(1)";},200);
  });
}

function interactiveAvatarReact(){
  avatars.forEach(avatar=>{
    avatar.style.transition="transform 0.15s ease";
    avatar.style.transform="translateY(-5px) rotate(5deg)";
    setTimeout(()=>{avatar.style.transform="translateY(0) rotate(0deg)";},150);
  });
}

</script>
</body>
</html>

